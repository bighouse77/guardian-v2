{% extends 'global/base.html' %}

{% block content %}
<h4>Análise de Exame</h4>

<!-- Formulário de pesquisa e seleção de paciente -->
<form method="GET" action="{% url 'glioma_analysis' %}">
    <div class="form-group">
        <label for="search">Pesquisar Paciente</label>
        <input type="text" class="form-control" id="search" name="search" value="{{ search_query }}" placeholder="Nome do Paciente">
    </div>
    
    <div class="form-group mt-3">
        <label for="patientSelect">Selecionar Paciente</label>
        <select class="form-select" id="patientSelect" name="patient_id">
            <option value="">Selecione o paciente...</option>
            {% for paciente in pacientes %}
                <option value="{{ paciente.id }}" {% if paciente.id == selected_patient_id %}selected{% endif %}>{{ paciente.nome_completo }}</option>
            {% endfor %}
        </select>
    </div>
    
    <button type="submit" class="btn btn-primary mt-3">Buscar</button>
</form>
<br>
<hr>
<br>

{% if paciente %}
    <!-- Se um paciente foi selecionado, exibir os detalhes e o exame -->
    <h3>Dados do Paciente</h3>
    <div class="row">
        <h6 class="col-md-1">Nome:</h6>
        <p class="col-md-11">{{ paciente.nome_completo }}</p>
    </div>
    <div class="row">
        <h6 class="col-md-1">Idade:</h6>
        <p class="col-md-11">{{ paciente.idade }}</p>
    </div>
    <div class="row">
        <h6 class="col-md-1">Sexo:</h6>
        <p class="col-md-11">{{ paciente.sexo }}</p>
    </div>
    <div class="row">
        <h6 class="col-md-1">Exame:</h6>
        <img src="{{ paciente.exame.url }}" alt="Exame de {{ paciente.nome_completo }}" class="img-fluid img-exame" />
    </div>

    <form method="post" class="mt-3">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Processar Exame</button>
    </form>

    <br>
    <hr>
    <br>
    
    {% if processed_image_url %}
        <h3>Resultado:</h3>
        <img src="{{ processed_image_url }}" alt="Imagem Processada" class="img-fluid img-processada" />
    {% endif %}
{% endif %}

<style>
    .img-exame {
        max-width: 300px; 
        height: auto;     
        display: block;
    }
    .img-processada {
        max-width: 300px; 
        height: auto;     
        display: block;
        margin-top: 20px;
    }
</style>

{% endblock %}
