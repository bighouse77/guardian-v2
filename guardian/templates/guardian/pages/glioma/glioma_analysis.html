{% extends 'global/base.html' %}

{% block content %}
<h4>Análise de Exame</h4>

<!-- Formulário de pesquisa e seleção de paciente -->
<form method="GET" action="{% url 'glioma_analysis' %}">
    <div class="form-group">
        <label for="search">Pesquisar Paciente</label>
        <input type="text" class="form-control" id="search" name="search" value="{{ search_query }}" placeholder="Nome do Paciente">
    </div>
    
    <div class="form-group mt-3">
        <label for="patientSelect">Selecionar Paciente</label>
        <select class="form-select" id="patientSelect" name="patient_id">
            <option value="">Selecione o paciente...</option>
            {% for paciente in pacientes %}
                <option value="{{ paciente.id }}" {% if paciente.id == selected_patient_id %}selected{% endif %}>{{ paciente.nome_completo }}</option>
            {% endfor %}
        </select>
    </div>
    
    <button type="submit" class="btn btn-primary mt-3">Buscar</button>
</form>

{% if paciente %}
    <!-- Se um paciente foi selecionado, exibir os detalhes e o exame -->
    <h4>Analisando: {{ paciente.nome_completo }}</h4>
    <img src="{{ paciente.exame.url }}" alt="Exame de {{ paciente.nome_completo }}" class="img-fluid" />

    <form method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary mt-3">Processar Exame</button>
    </form>
{% endif %}

{% endblock %}
